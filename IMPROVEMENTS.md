# Infinity2Chrome 书签导入功能改进

## 问题描述
原有代码无法从 `.infinity` 文件中读取书签数据,特别是当文件包含 `infinity` 文件夹结构时。

## 解决方案

### 1. 增强文件格式支持
修改了 `components/sites-viewer.tsx` 中的 `handleFileImport` 函数,现在支持以下多种 Infinity 备份文件格式:

#### 格式 1: 标准格式
```json
{
  "version": "...",
  "data": {
    "site": {
      "sites": [[...]]
    }
  }
}
```

#### 格式 2: infinity 文件夹格式
```json
{
  "infinity": {
    "version": "...",
    "data": {
      "site": {
        "sites": [[...]]
      }
    }
  }
}
```

#### 格式 3: 直接包含 site 的格式
```json
{
  "version": "...",
  "site": {
    "sites": [[...]]
  }
}
```

#### 格式 4: infinity 对象直接包含 site
```json
{
  "infinity": {
    "version": "...",
    "site": {
      "sites": [[...]]
    }
  }
}
```

### 2. 改进的错误提示
- 当文件格式无法识别时,会显示文件包含的顶层键
- 添加了详细的控制台日志,方便调试
- 错误信息更加友好和具体

### 3. 调试信息面板
- 添加了 `debugInfo` 状态来存储文件结构
- 在导入失败时,用户可以展开查看文件的完整 JSON 结构
- 帮助用户和开发者快速定位问题

### 4. 代码改进点
1. **灵活的数据提取**: 自动检测并适配不同的文件结构
2. **元数据回退**: 当某些元数据字段缺失时,使用默认值
3. **更好的错误处理**: 捕获并显示具体的错误信息
4. **调试友好**: 提供详细的文件结构信息

## 使用说明

### 导入文件
1. 点击"选择文件"按钮
2. 选择 `.infinity` 或 `.json` 格式的备份文件
3. 如果导入成功,会显示书签统计信息
4. 如果导入失败,会显示错误信息和调试选项

### 查看调试信息
如果导入失败:
1. 查看错误信息中显示的顶层键
2. 点击"点击查看文件结构详情 (用于调试)"
3. 查看完整的 JSON 结构
4. 根据结构判断文件是否为有效的 Infinity 备份

## 技术细节

### 修改的文件
- `components/sites-viewer.tsx`

### 新增状态
- `debugInfo: string | null` - 存储调试信息

### 修改的函数
- `handleFileImport()` - 增强文件解析逻辑
- `handleClearImport()` - 清除调试信息

### UI 改进
- 在错误提示下方添加可折叠的调试信息面板
- 使用 `<details>` 元素实现折叠效果
- 使用 `<pre>` 标签格式化显示 JSON

## 测试建议

建议测试以下场景:
1. ✅ 标准格式的 `.json` 文件
2. ✅ 标准格式的 `.infinity` 文件
3. ✅ 包含 `infinity` 文件夹的备份文件
4. ✅ 缺少某些元数据字段的文件
5. ✅ 完全无效的 JSON 文件
6. ✅ 非 Infinity 格式的 JSON 文件

## 后续优化建议

1. **文件格式自动检测**: 可以添加更智能的格式检测算法
2. **部分导入**: 即使某些数据损坏,也尝试导入有效的部分
3. **格式转换**: 提供将旧格式转换为新格式的功能
4. **批量导入**: 支持同时导入多个备份文件
5. **导入预览**: 在正式导入前预览将要导入的书签
